function namespace(namespaceString){for(var parts=namespaceString.split("."),parent=window,currentPart="",i=0,length=parts.length;length>i;i++)currentPart=parts[i],parent[currentPart]=parent[currentPart]||{},parent=parent[currentPart];return parent}String.prototype.format=function(){var args=arguments;return this.replace(/\{\{|\}\}|\{(\d+)\}/g,function(m,n){return"{{"==m?"{":"}}"==m?"}":args[n]})},Log=function(){var INFO=!0,ERROR=!0,DEBUG=!1,enableDebug=function(){DEBUG=!0},info=function(message){INFO&&console.log("[INFO]	"+_getDateString()+" -- "+message)},error=function(message){ERROR&&console.error("[ERROR]	"+_getDateString()+" -- "+message)},debug=function(message){DEBUG&&console.log("[DEBUG]	"+_getDateString()+" -- "+message)},_getDateString=function(date){void 0===date&&(date=new Date);var hours=date.getHours();hours=1===hours.length?"0"+hours:hours;var minutes=date.getMinutes();minutes=1===minutes.length?"0"+minutes:minutes;var seconds=date.getSeconds();seconds=1===seconds.length?"0"+seconds:seconds;var milliseconds=date.getMilliseconds();return milliseconds=1===milliseconds.length?"00"+milliseconds:milliseconds,milliseconds=2===milliseconds.length?"0"+milliseconds:milliseconds,hours+":"+minutes+":"+seconds+"."+milliseconds};return{enableDebug:enableDebug,info:info,error:error,debug:debug}}(),EventManager=function(){var _events={},register=function(event,callback){if("string"!=typeof event)throw"Event name must be a string";if("function"!=typeof callback)throw"Event callback must be a function";_events[event]||(_events[event]=[]),_events[event].push(callback),Log.debug("Attached callback to "+event)},trigger=function(event){if(_events[event]){var args=Array.prototype.slice.call(arguments);args.shift(),Log.debug("Triggering event "+event);for(var i=0;_events[event].length>i;i++){var callback=_events[event][i];callback.apply(null,args)}}};return{register:register,trigger:trigger}}(),Huddle=function($){var glyph,WebSocket=window.WebSocket||window.MozWebSocket,DataTypes={Glyph:"Glyph",IdentifyDevice:"Digital",Proximity:"Proximity",Message:"Message"},ProximityTypes={Display:"Display",Hand:"Hand"};this.client=function(name){return this.name=name!==void 0?name:"",this.connected=!1,this.reconnect=!1,this.reconnectTimeout=null,this};var createGlyph=function(data){for(var dim=Math.sqrt(data.length),matrix=[],cols=[],j=0;data.length>j;j++){var c=parseInt(data[j]);j>0&&0==j%dim&&(matrix.push(cols),cols=[]),cols.push(c)}matrix.push(cols);var dimension=840,box=dimension/(matrix.length+2),canvas=document.createElement("canvas");canvas.width=dimension,canvas.height=dimension;for(var ctx=canvas.getContext("2d"),row=0;matrix.length>row;row++)for(var col=0;matrix[row].length>col;col++)ctx.fillStyle=matrix[row][col]?"white":"black",ctx.fillRect(box+box*col,box+box*row,box,box);var image=canvas.toDataURL("image/png");return image}.bind(this);this.connect=function(host,port){return this.host=host,this.port=port!==void 0?port:4711,doConnect(),this};var doConnect=function(){var sendAlive=function(){if(this.connected){var content='"Id": "{0}"'.format(this.id);send("Alive",content)}}.bind(this),aliveInterval=null,wsUri="ws://{0}".format(this.host);this.port&&(wsUri="{0}:{1}".format(wsUri,this.port)),this.socket=new WebSocket(wsUri),this.socket.onopen=function(){Log.info("Huddle connection open"),this.reconnectTimeout&&(clearInterval(this.reconnectTimeout),this.reconnectTimeout=null),this.connected=!0,setTimeout(function(){var content='"Name": "{0}"'.format(this.name);send("Handshake",content)},500),aliveInterval=setInterval(sendAlive,1e4)}.bind(this),this.socket.onmessage=function(event){if(event&&event.data){var data;try{data=JSON.parse(event.data)}catch(exception){data=event.data}data&&onData(data)}}.bind(this),this.socket.onerror=function(event){Log.error("Huddle Error {0}".format(event)),aliveInterval&&clearInterval(aliveInterval),this.connected=!1,this.reconnect&&!this.reconnectTimeout&&(this.reconnectTimeout=setInterval(function(){doConnect(this.host,this.port)},1e3))}.bind(this),this.socket.onclose=function(event){Log.info("Huddle Closed {0}".format(event)),aliveInterval&&clearInterval(aliveInterval),this.connected=!1,this.reconnect&&!this.reconnectTimeout&&(this.reconnectTimeout=setInterval(function(){doConnect(this.host,this.port)},1e3))}.bind(this)}.bind(this);this.close=function(){return this.socket&&this.socket.close(),this};var onData=function(data){if(data.Type)switch(data.Type){case DataTypes.Glyph:return this.id=data.Id,glyph=createGlyph(data.GlyphData),identifyDevice({Value:!0}),void 0;case DataTypes.IdentifyDevice:return identifyDevice(data.Data),void 0;case DataTypes.Proximity:return updateProximity(data.Data),void 0;case DataTypes.Message:return messageReceived(data.Event,data.Data),void 0}"function"==typeof this.undefinedData&&this.undefinedData(data)}.bind(this),identifyDevice=function(data){if(data.Value){if($("#huddle-glyph-container").length)return;var $glyphContainer=$('<div id="huddle-glyph-container"></div>').appendTo($("body"));$glyphContainer.css({top:"0",left:"0",position:"fixed","background-color":"white","vertical-align":"bottom","margin-left":"auto","margin-right":"auto",width:"100%",height:"100%"});var $glyph=$glyphContainer.append('<div id="huddle-glyph-{0}"></div>'.format(this.id));$glyph.css({left:"0",top:"0",width:"100%",height:"100%","background-size":"contain","background-repeat":"no-repeat","background-position":"center","background-image":"url('"+glyph+"')"})}else $("#huddle-glyph-container").remove();EventManager.trigger("identify",data)}.bind(this),updateProximity=function(data){switch(EventManager.trigger("proximity",data),data.Type){case ProximityTypes.Display:EventManager.trigger("displaymove",data);break;case ProximityTypes.Hand:EventManager.trigger("handmove",data)}}.bind(this),messageReceived=function(event,data){EventManager.trigger(event,data)}.bind(this);(function(){}).bind(this),this.broadcast=function(event,msg){return send(DataTypes.Message,'"Event": "{0}", "Data": {1}'.format(event,msg)),this};var send=function(type,content){var msg='{{"Type": "{0}", {1}}}'.format(type,content);this.socket.send(msg)}.bind(this);return this.on=function(event,callback){return EventManager.register(event,callback),this},this}.call({},jQuery);