<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Flocking Devices Demo</title>
    <meta charset="utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">
        function openConnection() {

            var $ = jQuery;

            var dimension = {
                "width": 1024,
                "height": 768
            };

            // uses global 'conn' object
            if (conn.readyState === undefined || conn.readyState > 1) {

                conn = new WebSocket('ws://192.168.1.206:4711');

                conn.onopen = function () {
                    conn.send("Connection Established Confirmation");
                };

                conn.onmessage = function (event) {
                    //document.getElementById("content").innerHTML += event.data + "<br />";

                    var json = JSON.parse(event.data);

                    var location = json.Location.split(",");
                    var x = location[0];
                    var y = location[1];
                    var angle = json.Orientation;

                    //console.log(x + "/" + y);

                    var width = $('#device').width(); // 3840
                    var height = $('#device').height(); // 2160

                    //console.log(width + " / " + height);

                    var offsetLeft = width * x - (dimension['width'] / 2);
                    var offsetTop = height * y - (dimension['height'] / 2);

                    //var xAbsOff = xAbs - (dimension['width'] / 2);
                    //var yAbsOff = yAbs - (dimension['height'] / 2);

                    //var xCorrAbs = width - xAbsOff;
                    //var yCorrAbs = height - yAbsOff;

                    //console.log(xAbsOff + "/" + yAbsOff);

                    //$('#device').left(xAbsOff);
                    //$('#device').top(yAbsOff);

                    $('#device').css('left', -offsetLeft + "px");
                    $('#device').css('top', -offsetTop + "px");

                    $('#content').html(JSON.stringify(json));
                };

                conn.onerror = function (event) {
                    console.log("Web Socket Error");
                };


                conn.onclose = function (event) {
                    console.log("Web Socket Closed");
                };
            }
        }

        $(document).ready(function () {
            conn = {}, window.WebSocket = window.WebSocket || window.MozWebSocket;
            openConnection();
        });
    </script>
</head>
<body>
    <div id="container" style="width: 1024px; height: 768px; background-color: yellow;">
        <img id="device" src="GGJ_bunny_300.png" style="width: 3840px; height: 2160px; clear: both; position: absolute;" />
        <div style="width: 1024px; height: 768px; border: 2px solid green; position: relative; clear: both;"></div>-->
    </div>
    <div id="content"></div>
</body>
</html>